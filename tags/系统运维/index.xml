<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>系统运维 on zj8487的博客</title>
    <link>http://blog.zj8487.com/tags/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/</link>
    <description>Recent content in 系统运维 on zj8487的博客</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>zj8487© 2015 Copyright Text</copyright>
    <lastBuildDate>Mon, 09 Nov 2015 19:39:14 +0800</lastBuildDate>
    <atom:link href="http://blog.zj8487.com/tags/%E7%B3%BB%E7%BB%9F%E8%BF%90%E7%BB%B4/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>2015 11 09 ubuntu定期自动删除日志</title>
      <link>http://blog.zj8487.com/post/2015/2015-11-09-ubuntu%E5%AE%9A%E6%9C%9F%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%E5%A4%9A%E4%BD%99%E6%97%A5%E5%BF%97/</link>
      <pubDate>Mon, 09 Nov 2015 19:39:14 +0800</pubDate>
      
      <guid>http://blog.zj8487.com/post/2015/2015-11-09-ubuntu%E5%AE%9A%E6%9C%9F%E8%87%AA%E5%8A%A8%E5%88%A0%E9%99%A4%E5%A4%9A%E4%BD%99%E6%97%A5%E5%BF%97/</guid>
      <description>

&lt;h1 id=&#34;需求来源:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;需求来源&lt;/h1&gt;

&lt;p&gt;服务器后台托管在阿里云上，使用的是Ubuntu系统。每天系统运行会产生很多日志，但是购买的阿里云主机磁盘空间是有限的。时间一长，磁盘就被塞满了，这还导致了一两次系统系统服务器中断。
为了保证磁盘空余，就需要定时清理日志。比如我们只保持最近N天的日志。&lt;/p&gt;

&lt;h1 id=&#34;ubuntu的cron服务:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;Ubuntu的cron服务&lt;/h1&gt;

&lt;p&gt;cron服务提供crontab命令来设定cron服务的，任务调度分为两类，系统任务调度和用户任务调度。系统任务调度可直接编辑/etc/crontab文件进行配置。&lt;/p&gt;

&lt;h2 id=&#34;crontab文件的含义:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;crontab文件的含义&lt;/h2&gt;

&lt;p&gt;每一行都代表一项任务，每行的每个字段代表一项设置，它的格式共分为七个字段，前五段是时间设定段，第七段是要执行的命令段，格式如下:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# m h   dom mon dow  user     command
 17 *    *   *   *   root    cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.hourly
 25 6    *   *   *   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.daily )
 47 6    *   *   7   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.weekly )
 52 6    1   *   *   root    test -x /usr/sbin/anacron || ( cd / &amp;amp;&amp;amp; run-parts --report /etc/cron.monthly )
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;m(minute)： 表示分钟，可以是从0到59之间的任何整数。&lt;/p&gt;

&lt;p&gt;h(hour)：表示小时，可以是从0到23之间的任何整数。&lt;/p&gt;

&lt;p&gt;dom(day)：表示日期，可以是从1到31之间的任何整数。&lt;/p&gt;

&lt;p&gt;mon(month)：表示月份，可以是从1到12之间的任何整数。&lt;/p&gt;

&lt;p&gt;dow(week)：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。&lt;/p&gt;

&lt;p&gt;command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。&lt;/p&gt;

&lt;h1 id=&#34;具体配置:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;具体配置&lt;/h1&gt;

&lt;p&gt;假如我们计划在每天10：45分进行操作。脚本名为：&lt;code&gt;remove_expired_log.sh&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;我们直接在/etc/crontab文件中添加如下配置&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;45 10   * * *   root    sudo /path_to_your_project/remove_expired_log.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在脚本中我们假设存放日志的文件目录为log，并且他位于该脚本所在目录的父目录中。&lt;/p&gt;

&lt;h2 id=&#34;remove-expired-log-sh:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;remove_expired_log.sh&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;#!/bin/bash

echo $(pwd)

PRE_PWD=$(pwd)

SCRIPT_PATH=$0
WORK_PATH=$(dirname $(dirname $SCRIPT_PATH))
cd $WORK_PATH

find ./log/ -mtime +4 -name &amp;quot;*.log.201*&amp;quot; -exec rm -rf {} \;

cd $PRE_PWD
echo $(pwd)
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;总结:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;总结&lt;/h1&gt;

&lt;p&gt;使用系统自带的cron服务很方便的完成了我们的任务。配置也比较简单。只需要配置好时间和执行脚本就ok了&lt;/p&gt;

&lt;h2 id=&#34;参考文献:cbfbc550fbf29c042c9d11dd2032cbde&#34;&gt;参考文献&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://www.cnblogs.com/peida/archive/2013/01/08/2850483.html&#34;&gt;http://www.cnblogs.com/peida/archive/2013/01/08/2850483.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.csdn.net/androidmylove/article/details/41518961&#34;&gt;http://blog.csdn.net/androidmylove/article/details/41518961&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>